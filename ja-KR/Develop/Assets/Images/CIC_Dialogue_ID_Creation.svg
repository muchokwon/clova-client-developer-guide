<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1070px" preserveAspectRatio="none" style="width:610px;height:1070px;" version="1.1" viewBox="0 0 610 1070" width="610px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="360.1953" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="210" y="104.6211"/><line style="stroke: #000000; stroke-width: 1.0;" x1="210" x2="210" y1="104.6211" y2="464.8164"/><line style="stroke: #000000; stroke-width: 1.0;" x1="220" x2="220" y1="104.6211" y2="464.8164"/><line style="stroke: #000000; stroke-width: 1.0;" x1="210" x2="220" y1="104.6211" y2="104.6211"/><rect fill="#FFFFFF" height="522.4609" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="210" y="526.9492"/><line style="stroke: #000000; stroke-width: 1.0;" x1="210" x2="210" y1="526.9492" y2="1049.4102"/><line style="stroke: #000000; stroke-width: 1.0;" x1="220" x2="220" y1="526.9492" y2="1049.4102"/><line style="stroke: #000000; stroke-width: 1.0;" x1="210" x2="220" y1="1049.4102" y2="1049.4102"/><rect fill="#FFFFFF" height="215.9297" rx="5" ry="5" style="stroke: #000000; stroke-width: 2.0;" width="446.5" x="152" y="180.7539"/><rect fill="#FFFFFF" height="98.3984" style="stroke: none; stroke-width: 1.0;" width="446.5" x="152" y="298.2852"/><rect fill="#FFFFFF" height="398.1953" rx="5" ry="5" style="stroke: #000000; stroke-width: 2.0;" width="569.5" x="29" y="643.2148"/><rect fill="#FFFFFF" height="97.2656" style="stroke: none; stroke-width: 1.0;" width="569.5" x="29" y="944.1445"/><line style="stroke: #000000; stroke-width: 1.0;" x1="49" x2="49" y1="54.4883" y2="464.8164"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="49" x2="49" y1="464.8164" y2="526.9492"/><line style="stroke: #000000; stroke-width: 1.0;" x1="49" x2="49" y1="526.9492" y2="1058.4102"/><line style="stroke: #000000; stroke-width: 1.0;" x1="215" x2="215" y1="54.4883" y2="464.8164"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="215" x2="215" y1="464.8164" y2="526.9492"/><line style="stroke: #000000; stroke-width: 1.0;" x1="215" x2="215" y1="526.9492" y2="1058.4102"/><line style="stroke: #000000; stroke-width: 1.0;" x1="558.5" x2="558.5" y1="54.4883" y2="464.8164"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="558.5" x2="558.5" y1="464.8164" y2="526.9492"/><line style="stroke: #000000; stroke-width: 1.0;" x1="558.5" x2="558.5" y1="526.9492" y2="1058.4102"/><rect fill="#9EA0CA" height="50.4883" rx="5" ry="5" style="stroke: #FFFFFF; stroke-width: 1.5;" width="82" x="8" y="3"/><text fill="#FFFFFF" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="48" x="25" y="33.5352">ユーザー</text><rect fill="#9EA0CA" height="50.4883" rx="5" ry="5" style="stroke: #FFFFFF; stroke-width: 1.5;" width="106" x="162" y="3"/><text fill="#FFFFFF" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72" x="179" y="33.5352">クライアント</text><rect fill="#05D686" height="50.4883" rx="5" ry="5" style="stroke: #FFFFFF; stroke-width: 1.5;" width="59" x="529.5" y="3"/><text fill="#FFFFFF" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="546.5" y="33.5352">CIC</text><rect fill="#FFFFFF" height="360.1953" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="210" y="104.6211"/><line style="stroke: #000000; stroke-width: 1.0;" x1="210" x2="210" y1="104.6211" y2="464.8164"/><line style="stroke: #000000; stroke-width: 1.0;" x1="220" x2="220" y1="104.6211" y2="464.8164"/><line style="stroke: #000000; stroke-width: 1.0;" x1="210" x2="220" y1="104.6211" y2="104.6211"/><rect fill="#FFFFFF" height="522.4609" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="210" y="526.9492"/><line style="stroke: #000000; stroke-width: 1.0;" x1="210" x2="210" y1="526.9492" y2="1049.4102"/><line style="stroke: #000000; stroke-width: 1.0;" x1="220" x2="220" y1="526.9492" y2="1049.4102"/><line style="stroke: #000000; stroke-width: 1.0;" x1="210" x2="220" y1="1049.4102" y2="1049.4102"/><line style="stroke: #000000; stroke-width: 1.0;" x1="208" x2="198" y1="104.6211" y2="100.6211"/><line style="stroke: #000000; stroke-width: 1.0;" x1="208" x2="198" y1="104.6211" y2="108.6211"/><line style="stroke: #000000; stroke-width: 1.0;" x1="49" x2="209" y1="104.6211" y2="104.6211"/><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="122" x="68.5" y="90.0898">クラシック音楽を再生して</text><line style="stroke: #000000; stroke-width: 1.0;" x1="220" x2="262" y1="152.7539" y2="152.7539"/><line style="stroke: #000000; stroke-width: 1.0;" x1="262" x2="262" y1="152.7539" y2="165.7539"/><line style="stroke: #000000; stroke-width: 1.0;" x1="221" x2="262" y1="165.7539" y2="165.7539"/><polygon fill="#000000" points="231,161.7539,221,165.7539,231,169.7539,227,165.7539" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="128" x="237" y="138.2227">ダイアログID(A)を作成する</text><path d="M157,180.7539 L233,180.7539 L233,206.7539 L223,216.7539 L152,216.7539 L152,185.7539 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="215.9297" rx="5" ry="5" style="stroke: #000000; stroke-width: 2.0;" width="446.5" x="152" y="180.7539"/><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16" x="177" y="203.3555">alt</text><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="130" x="258" y="204.3555">[音声でリクエストした場合]</text><line style="stroke: #000000; stroke-width: 1.0;" x1="557" x2="547" y1="290.2852" y2="286.2852"/><line style="stroke: #000000; stroke-width: 1.0;" x1="557" x2="547" y1="290.2852" y2="294.2852"/><line style="stroke: #000000; stroke-width: 1.0;" x1="220" x2="558" y1="290.2852" y2="290.2852"/><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="258" x="260.5" y="261.6211">SpeechRecognizer.Recognizeイベントを送信する</text><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="162" x="308.5" y="275.7539">(header.dialogRequestId: A)</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="152" x2="598.5" y1="299.2852" y2="299.2852"/><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="148" x="167" y="320.8867">[テキストでリクエストした場合]</text><line style="stroke: #000000; stroke-width: 1.0;" x1="557" x2="547" y1="388.6836" y2="384.6836"/><line style="stroke: #000000; stroke-width: 1.0;" x1="557" x2="547" y1="388.6836" y2="392.6836"/><line style="stroke: #000000; stroke-width: 1.0;" x1="220" x2="558" y1="388.6836" y2="388.6836"/><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="243" x="268" y="360.0195">TextRecognizer.Recognizeイベントを送信する</text><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="162" x="308.5" y="374.1523">(header.dialogRequestId: A)</text><line style="stroke: #000000; stroke-width: 1.0;" x1="220" x2="262" y1="443.8164" y2="443.8164"/><line style="stroke: #000000; stroke-width: 1.0;" x1="262" x2="262" y1="443.8164" y2="456.8164"/><line style="stroke: #000000; stroke-width: 1.0;" x1="221" x2="262" y1="456.8164" y2="456.8164"/><polygon fill="#000000" points="231,452.8164,221,456.8164,231,460.8164,227,456.8164" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="132" x="237" y="429.2852">最終ダイアログIDを更新する</text><path d="M39,416.0059 L39,452.0059 A5,5 0 0 0 44,457.0059 L200,457.0059 A5,5 0 0 0 205,452.0059 L205,421.0059 L195,411.0059 L44,411.0059 A5,5 0 0 0 39,416.0059 " fill="#9EA0CA" style="stroke: #FFFFFF; stroke-width: 1.0;"/><path d="M195,411.0059 L195,418.5059 A2.5,2.5 0 0 0 197.5,421.0059 L205,421.0059 L195,411.0059 " fill="#9EA0CA" style="stroke: #FFFFFF; stroke-width: 1.0;"/><text fill="#FFFFFF" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="55" y="439.541">lastDialogueID: A</text><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="92" x="258" y="500.418">リクエストを処理中</text><line style="stroke: #000000; stroke-width: 1.0;" x1="208" x2="198" y1="567.082" y2="563.082"/><line style="stroke: #000000; stroke-width: 1.0;" x1="208" x2="198" y1="567.082" y2="571.082"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="49" x2="209" y1="567.082" y2="567.082"/><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="84" x="87.5" y="552.5508">今の天気を教えて</text><line style="stroke: #000000; stroke-width: 1.0;" x1="220" x2="262" y1="615.2148" y2="615.2148"/><line style="stroke: #000000; stroke-width: 1.0;" x1="262" x2="262" y1="615.2148" y2="628.2148"/><line style="stroke: #000000; stroke-width: 1.0;" x1="221" x2="262" y1="628.2148" y2="628.2148"/><polygon fill="#000000" points="231,624.2148,221,628.2148,231,632.2148,227,628.2148" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="127" x="237" y="600.6836">ダイアログID(B)を作成する</text><path d="M34,643.2148 L110,643.2148 L110,669.2148 L100,679.2148 L29,679.2148 L29,648.2148 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="398.1953" rx="5" ry="5" style="stroke: #000000; stroke-width: 2.0;" width="569.5" x="29" y="643.2148"/><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16" x="54" y="665.8164">alt</text><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="130" x="135" y="666.8164">[作業を正常に処理する場合]</text><line style="stroke: #000000; stroke-width: 1.0;" x1="557" x2="547" y1="752.7461" y2="748.7461"/><line style="stroke: #000000; stroke-width: 1.0;" x1="557" x2="547" y1="752.7461" y2="756.7461"/><line style="stroke: #000000; stroke-width: 1.0;" x1="220" x2="558" y1="752.7461" y2="752.7461"/><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="258" x="260.5" y="724.082">SpeechRecognizer.Recognizeイベントを送信する</text><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="161" x="309" y="738.2148">(header.dialogRequestId: B)</text><line style="stroke: #000000; stroke-width: 1.0;" x1="220" x2="262" y1="800.8789" y2="800.8789"/><line style="stroke: #000000; stroke-width: 1.0;" x1="262" x2="262" y1="800.8789" y2="813.8789"/><line style="stroke: #000000; stroke-width: 1.0;" x1="221" x2="262" y1="813.8789" y2="813.8789"/><polygon fill="#000000" points="231,809.8789,221,813.8789,231,817.8789,227,813.8789" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="132" x="237" y="786.3477">最終ダイアログIDを更新する</text><path d="M40,773.0684 L40,809.0684 A5,5 0 0 0 45,814.0684 L200,814.0684 A5,5 0 0 0 205,809.0684 L205,778.0684 L195,768.0684 L45,768.0684 A5,5 0 0 0 40,773.0684 " fill="#9EA0CA" style="stroke: #FFFFFF; stroke-width: 1.0;"/><path d="M195,768.0684 L195,775.5684 A2.5,2.5 0 0 0 197.5,778.0684 L205,778.0684 L195,768.0684 " fill="#9EA0CA" style="stroke: #FFFFFF; stroke-width: 1.0;"/><text fill="#FFFFFF" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="124" x="56" y="796.6035">lastDialogueID: B</text><line style="stroke: #000000; stroke-width: 1.0;" x1="220" x2="262" y1="862.0117" y2="862.0117"/><line style="stroke: #000000; stroke-width: 1.0;" x1="262" x2="262" y1="862.0117" y2="875.0117"/><line style="stroke: #000000; stroke-width: 1.0;" x1="221" x2="262" y1="875.0117" y2="875.0117"/><polygon fill="#000000" points="231,871.0117,221,875.0117,231,879.0117,227,875.0117" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="252" x="237" y="847.4805">前のダイアログID(A)に関連する作業の処理を中止する</text><line style="stroke: #000000; stroke-width: 1.0;" x1="220" x2="262" y1="923.1445" y2="923.1445"/><line style="stroke: #000000; stroke-width: 1.0;" x1="262" x2="262" y1="923.1445" y2="936.1445"/><line style="stroke: #000000; stroke-width: 1.0;" x1="221" x2="262" y1="936.1445" y2="936.1445"/><polygon fill="#000000" points="231,932.1445,221,936.1445,231,940.1445,227,936.1445" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="300" x="237" y="908.6133">ダイアログID(A)に関連するディレクティブをキューから破棄する</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="29" x2="598.5" y1="945.1445" y2="945.1445"/><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="250" x="44" y="966.7461">[例外が発生してイベントの送信をキャンセルする場合]</text><line style="stroke: #000000; stroke-width: 1.0;" x1="220" x2="262" y1="1020.4102" y2="1020.4102"/><line style="stroke: #000000; stroke-width: 1.0;" x1="262" x2="262" y1="1020.4102" y2="1033.4102"/><line style="stroke: #000000; stroke-width: 1.0;" x1="221" x2="262" y1="1033.4102" y2="1033.4102"/><polygon fill="#000000" points="231,1029.4102,221,1033.4102,231,1037.4102,227,1033.4102" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="264" x="237" y="1005.8789">前のダイアログID(A)に関連する作業を引き続き処理する</text><path d="M39,992.5996 L39,1028.5996 A5,5 0 0 0 44,1033.5996 L200,1033.5996 A5,5 0 0 0 205,1028.5996 L205,997.5996 L195,987.5996 L44,987.5996 A5,5 0 0 0 39,992.5996 " fill="#9EA0CA" style="stroke: #FFFFFF; stroke-width: 1.0;"/><path d="M195,987.5996 L195,995.0996 A2.5,2.5 0 0 0 197.5,997.5996 L205,997.5996 L195,987.5996 " fill="#9EA0CA" style="stroke: #FFFFFF; stroke-width: 1.0;"/><text fill="#FFFFFF" font-family="&quot;Malgun Gothic&quot;, sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="55" y="1016.1348">lastDialogueID: A</text><!--
@startuml
scale max 880 width
skinparam sequenceMessageAlign center
skinparam shadowing false
skinparam roundcorner 10
skinparam padding 10
skinparam defaultFontSize 12
skinparam defaultFontName "Malgun Gothic", sans-serif

skinparam note {
  BackgroundColor #9EA0CA
  BorderColor #ffffff
  FontColor #ffffff
  FontSize 14
  FontStyle bold
}

skinparam sequence {
  ArrowColor #000000
  ActorBorderColor #000000
  ActorFontStyle Bolder


  LifeLineBorderColor #000000
  LifeLineBackgroundColor transparent
  ParticipantBorderColor transparent
  ParticipantFontSize 14
  ParticipantFontColor #ffffff
  ParticipantFontStyle bold

  BoxBorderColor #000000
  BoxFontColor #ffffff
    BoxFontSize 14
    BoxFontStyle bold
}
hide footbox

skinparam activity {
  BackgroundColor #9EA0CA
  BarColor #ffffff
  BorderColor #ffffff
  DiamondBackgroundColor #05D686
  DiamondBorderColor #ffffff
  DiamondFontColor #ffffff
  DiamondFontSize 14
  DiamondFontStyle bold
  FontColor #ffffff 
  FontSize 14
  FontStyle bold
}

participant ユーザー as user #9EA0CA
participant クライアント as client #9EA0CA
participant CIC as cic #05D686

user ->> client: クラシック音楽を再生して

activate client

  client -> client: ダイアログID(A)を作成する

  alt 音声でリクエストした場合

    client ->> cic: SpeechRecognizer.Recognizeイベントを送信する\n(header.dialogRequestId: A)

  else テキストでリクエストした場合

    client ->> cic: TextRecognizer.Recognizeイベントを送信する\n(header.dialogRequestId: A)

  end

  client -> client: 最終ダイアログIDを更新する
  
  note left: lastDialogueID: A

  ... リクエストを処理中 ...

user - ->> client: 今の天気を教えて

  client -> client: ダイアログID(B)を作成する

  alt 作業を正常に処理する場合

    client ->> cic: SpeechRecognizer.Recognizeイベントを送信する\n(header.dialogRequestId: B)

    client -> client: 最終ダイアログIDを更新する
  
    note left: lastDialogueID: B

    client -> client: 前のダイアログID(A)に関連する作業の処理を中止する

    client -> client: ダイアログID(A)に関連するディレクティブをキューから破棄する

  else 例外が発生してイベントの送信をキャンセルする場合

    client -> client: 前のダイアログID(A)に関連する作業を引き続き処理する

    note left: lastDialogueID: A

  end

@enduml

PlantUML version 1.2018.12(Sun Oct 21 19:15:15 KST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11+28
Operating System: Mac OS X
OS Version: 10.14.2
Default Encoding: US-ASCII
Language: en
Country: KR
--></g></svg>