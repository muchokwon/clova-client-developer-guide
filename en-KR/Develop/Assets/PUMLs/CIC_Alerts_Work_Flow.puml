!include ../../../styles/PlantUML_StyleSheet.puml

actor User as user #9EA0CA
participant Client as client #9EA0CA
participant CIC as cic #05D686

user ->> client : Requests to add an alarm:\n"Set an alarm for 9 PM today."

activate client
  client ->> cic : Sends user request\n(SpeechRecognizer.Recognize event)
deactivate client

activate cic
  cic -> cic : Analyzes user utterance
  cic -->> client : Sends Alerts.SetAlert directive
deactivate cic

activate client
  client -> client : Adds an alarm to client device

opt Result of adding an alarm == Failed to add

  client ->> cic : Sends Alerts.SetAlertFailed event
  deactivate client
  activate cic

    cic -->> client : Sends SpeechSynthesizer.Speak directive\n("Could not set the alarm.")

  deactivate cic

  activate client
    client -->> user : Sends result of adding an alarm

else Result of adding an alarm == Success

  client ->> cic : Sends Alerts.SetAlertSucceeded event

deactivate client

activate cic

  cic -> cic : Adds user alarm
  cic -->> client : Sends SpeechSynthesizer.Speak directive\n("The alarm is set.")

activate client
  cic -->> client : Sends Actiontimer, Alarm, Reminder, and Timer templates\n(Clova.RenderTemplate directive)
deactivate cic

  client -> client : Outputs voice and display added alarm details
  client -->> user : Sends result of adding an alarm


...

  client -> client : Start alarm
  client ->> cic : Reports start of alarm\n(Alerts.AlertStarted event,\linclude activateAlerts as a required field in Alert.AlertsState)

  activate cic
  deactivate cic

  user ->> client : Requests to stop alarm (using utterance or physical button)

  alt Type of stop alarm request == User utterance

    client ->> cic : Sends request to stop alarm\n(SpeechRecognizer.Recognize event)

  activate cic

  else Type of stop alarm request == Physical button

    client ->> cic : Sends request to stop alarm\n(Alerts.RequestAlertStop event)

  end

  cic -->> client : Sends Alerts.StopAlert directive

  deactivate cic

  client ->> cic : Reports result of stop alarm\n(Alerts.AlertStopped event)

  activate cic

    opt Alarm is repeated == Yes

      cic -->> client : Sends next repeated alarm\n(Alerts.SetAlert directive)
    end

    opt Alarm type == Action timer

      cic -->> client : Sends the directive to perform the user-scheduled action

  deactivate cic

      client -> client : Performs scheduled action

    end

  deactivate client
  deactivate cic

  end
