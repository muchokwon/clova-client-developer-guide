<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1092px" preserveAspectRatio="none" style="width:689px;height:1092px;" version="1.1" viewBox="0 0 689 1092" width="689px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="368.8438" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="238" y="106.7031"/><line style="stroke: #000000; stroke-width: 1.0;" x1="238" x2="238" y1="106.7031" y2="475.5469"/><line style="stroke: #000000; stroke-width: 1.0;" x1="248" x2="248" y1="106.7031" y2="475.5469"/><line style="stroke: #000000; stroke-width: 1.0;" x1="238" x2="248" y1="106.7031" y2="106.7031"/><rect fill="#FFFFFF" height="533.0313" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="238" y="538.6406"/><line style="stroke: #000000; stroke-width: 1.0;" x1="238" x2="238" y1="538.6406" y2="1071.6719"/><line style="stroke: #000000; stroke-width: 1.0;" x1="248" x2="248" y1="538.6406" y2="1071.6719"/><line style="stroke: #000000; stroke-width: 1.0;" x1="238" x2="248" y1="1071.6719" y2="1071.6719"/><rect fill="#FFFFFF" height="222.6563" rx="5" ry="5" style="stroke: #000000; stroke-width: 2.0;" width="506" x="171" y="183.7969"/><rect fill="#FFFFFF" height="101.2813" style="stroke: none; stroke-width: 1.0;" width="506" x="171" y="305.1719"/><rect fill="#FFFFFF" height="406.8438" rx="5" ry="5" style="stroke: #000000; stroke-width: 2.0;" width="614" x="63" y="656.8281"/><rect fill="#FFFFFF" height="99.1875" style="stroke: none; stroke-width: 1.0;" width="614" x="63" y="964.4844"/><line style="stroke: #000000; stroke-width: 1.0;" x1="55" x2="55" y1="55.6094" y2="475.5469"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="55" x2="55" y1="475.5469" y2="538.6406"/><line style="stroke: #000000; stroke-width: 1.0;" x1="55" x2="55" y1="538.6406" y2="1080.6719"/><line style="stroke: #000000; stroke-width: 1.0;" x1="243" x2="243" y1="55.6094" y2="475.5469"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="243" x2="243" y1="475.5469" y2="538.6406"/><line style="stroke: #000000; stroke-width: 1.0;" x1="243" x2="243" y1="538.6406" y2="1080.6719"/><line style="stroke: #000000; stroke-width: 1.0;" x1="638" x2="638" y1="55.6094" y2="475.5469"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="638" x2="638" y1="475.5469" y2="538.6406"/><line style="stroke: #000000; stroke-width: 1.0;" x1="638" x2="638" y1="538.6406" y2="1080.6719"/><rect fill="#9EA0CA" height="51.6094" rx="5" ry="5" style="stroke: #FFFFFF; stroke-width: 1.5;" width="94" x="8" y="3"/><text fill="#FFFFFF" font-family="Noto Sans CJK KR" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="60" x="25" y="34.5332">ユーザー</text><rect fill="#9EA0CA" height="51.6094" rx="5" ry="5" style="stroke: #FFFFFF; stroke-width: 1.5;" width="124" x="181" y="3"/><text fill="#FFFFFF" font-family="Noto Sans CJK KR" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="90" x="198" y="34.5332">クライアント</text><rect fill="#05D686" height="51.6094" rx="5" ry="5" style="stroke: #FFFFFF; stroke-width: 1.5;" width="58" x="609" y="3"/><text fill="#FFFFFF" font-family="Noto Sans CJK KR" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="24" x="626" y="34.5332">CIC</text><rect fill="#FFFFFF" height="368.8438" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="238" y="106.7031"/><line style="stroke: #000000; stroke-width: 1.0;" x1="238" x2="238" y1="106.7031" y2="475.5469"/><line style="stroke: #000000; stroke-width: 1.0;" x1="248" x2="248" y1="106.7031" y2="475.5469"/><line style="stroke: #000000; stroke-width: 1.0;" x1="238" x2="248" y1="106.7031" y2="106.7031"/><rect fill="#FFFFFF" height="533.0313" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="238" y="538.6406"/><line style="stroke: #000000; stroke-width: 1.0;" x1="238" x2="238" y1="538.6406" y2="1071.6719"/><line style="stroke: #000000; stroke-width: 1.0;" x1="248" x2="248" y1="538.6406" y2="1071.6719"/><line style="stroke: #000000; stroke-width: 1.0;" x1="238" x2="248" y1="1071.6719" y2="1071.6719"/><line style="stroke: #000000; stroke-width: 1.0;" x1="236" x2="226" y1="106.7031" y2="102.7031"/><line style="stroke: #000000; stroke-width: 1.0;" x1="236" x2="226" y1="106.7031" y2="110.7031"/><line style="stroke: #000000; stroke-width: 1.0;" x1="55" x2="237" y1="106.7031" y2="106.7031"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="144" x="74.5" y="92.0664">クラシック音楽を再生して</text><line style="stroke: #000000; stroke-width: 1.0;" x1="248" x2="290" y1="155.7969" y2="155.7969"/><line style="stroke: #000000; stroke-width: 1.0;" x1="290" x2="290" y1="155.7969" y2="168.7969"/><line style="stroke: #000000; stroke-width: 1.0;" x1="249" x2="290" y1="168.7969" y2="168.7969"/><polygon fill="#000000" points="259,164.7969,249,168.7969,259,172.7969,255,168.7969" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="147" x="265" y="141.1602">ダイアログID(A)を作成する</text><path d="M176,183.7969 L250,183.7969 L250,210.7969 L240,220.7969 L171,220.7969 L171,188.7969 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="222.6563" rx="5" ry="5" style="stroke: #000000; stroke-width: 2.0;" width="506" x="171" y="183.7969"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="196" y="207.2539">alt</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="164" x="275" y="208.2539">[音声でリクエストした場合]</text><line style="stroke: #000000; stroke-width: 1.0;" x1="636" x2="626" y1="297.1719" y2="293.1719"/><line style="stroke: #000000; stroke-width: 1.0;" x1="636" x2="626" y1="297.1719" y2="301.1719"/><line style="stroke: #000000; stroke-width: 1.0;" x1="248" x2="637" y1="297.1719" y2="297.1719"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="273" x="306.5" y="267.4414">SpeechRecognizer.Recognizeイベントを送信する</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="154" x="366" y="282.5352">(header.dialogRequestId: A)</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="171" x2="677" y1="306.1719" y2="306.1719"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="190" x="186" y="328.6289">[テキストでリクエストした場合]</text><line style="stroke: #000000; stroke-width: 1.0;" x1="636" x2="626" y1="398.4531" y2="394.4531"/><line style="stroke: #000000; stroke-width: 1.0;" x1="636" x2="626" y1="398.4531" y2="402.4531"/><line style="stroke: #000000; stroke-width: 1.0;" x1="248" x2="637" y1="398.4531" y2="398.4531"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="253" x="316.5" y="368.7227">TextRecognizer.Recognizeイベントを送信する</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="154" x="366" y="383.8164">(header.dialogRequestId: A)</text><line style="stroke: #000000; stroke-width: 1.0;" x1="248" x2="290" y1="454.5469" y2="454.5469"/><line style="stroke: #000000; stroke-width: 1.0;" x1="290" x2="290" y1="454.5469" y2="467.5469"/><line style="stroke: #000000; stroke-width: 1.0;" x1="249" x2="290" y1="467.5469" y2="467.5469"/><polygon fill="#000000" points="259,463.5469,249,467.5469,259,471.5469,255,467.5469" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="156" x="265" y="439.9102">最終ダイアログIDを更新する</text><path d="M74,425.6953 L74,462.6953 A5,5 0 0 0 79,467.6953 L228,467.6953 A5,5 0 0 0 233,462.6953 L233,430.6953 L223,420.6953 L79,420.6953 A5,5 0 0 0 74,425.6953 " fill="#9EA0CA" style="stroke: #FFFFFF; stroke-width: 1.0;"/><path d="M223,420.6953 L223,428.1953 A2.5,2.5 0 0 0 225.5,430.6953 L233,430.6953 L223,420.6953 " fill="#9EA0CA" style="stroke: #FFFFFF; stroke-width: 1.0;"/><text fill="#FFFFFF" font-family="Noto Sans CJK KR" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="90" y="450.2285">lastDialogueID: A</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="108" x="292.5" y="512.0039">リクエストを処理中</text><line style="stroke: #000000; stroke-width: 1.0;" x1="236" x2="226" y1="579.7344" y2="575.7344"/><line style="stroke: #000000; stroke-width: 1.0;" x1="236" x2="226" y1="579.7344" y2="583.7344"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="55" x2="237" y1="579.7344" y2="579.7344"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="96" x="98.5" y="565.0977">今の天気を教えて</text><line style="stroke: #000000; stroke-width: 1.0;" x1="248" x2="290" y1="628.8281" y2="628.8281"/><line style="stroke: #000000; stroke-width: 1.0;" x1="290" x2="290" y1="628.8281" y2="641.8281"/><line style="stroke: #000000; stroke-width: 1.0;" x1="249" x2="290" y1="641.8281" y2="641.8281"/><polygon fill="#000000" points="259,637.8281,249,641.8281,259,645.8281,255,641.8281" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="148" x="265" y="614.1914">ダイアログID(B)を作成する</text><path d="M68,656.8281 L142,656.8281 L142,683.8281 L132,693.8281 L63,693.8281 L63,661.8281 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="406.8438" rx="5" ry="5" style="stroke: #000000; stroke-width: 2.0;" width="614" x="63" y="656.8281"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14" x="88" y="680.2852">alt</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="164" x="167" y="681.2852">[作業を正常に処理する場合]</text><line style="stroke: #000000; stroke-width: 1.0;" x1="636" x2="626" y1="770.2031" y2="766.2031"/><line style="stroke: #000000; stroke-width: 1.0;" x1="636" x2="626" y1="770.2031" y2="774.2031"/><line style="stroke: #000000; stroke-width: 1.0;" x1="248" x2="637" y1="770.2031" y2="770.2031"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="273" x="306.5" y="740.4727">SpeechRecognizer.Recognizeイベントを送信する</text><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="155" x="365.5" y="755.5664">(header.dialogRequestId: B)</text><line style="stroke: #000000; stroke-width: 1.0;" x1="248" x2="290" y1="819.2969" y2="819.2969"/><line style="stroke: #000000; stroke-width: 1.0;" x1="290" x2="290" y1="819.2969" y2="832.2969"/><line style="stroke: #000000; stroke-width: 1.0;" x1="249" x2="290" y1="832.2969" y2="832.2969"/><polygon fill="#000000" points="259,828.2969,249,832.2969,259,836.2969,255,832.2969" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="156" x="265" y="804.6602">最終ダイアログIDを更新する</text><path d="M73,790.4453 L73,827.4453 A5,5 0 0 0 78,832.4453 L228,832.4453 A5,5 0 0 0 233,827.4453 L233,795.4453 L223,785.4453 L78,785.4453 A5,5 0 0 0 73,790.4453 " fill="#9EA0CA" style="stroke: #FFFFFF; stroke-width: 1.0;"/><path d="M223,785.4453 L223,792.9453 A2.5,2.5 0 0 0 225.5,795.4453 L233,795.4453 L223,785.4453 " fill="#9EA0CA" style="stroke: #FFFFFF; stroke-width: 1.0;"/><text fill="#FFFFFF" font-family="Noto Sans CJK KR" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="119" x="89" y="814.9785">lastDialogueID: B</text><line style="stroke: #000000; stroke-width: 1.0;" x1="248" x2="290" y1="881.3906" y2="881.3906"/><line style="stroke: #000000; stroke-width: 1.0;" x1="290" x2="290" y1="881.3906" y2="894.3906"/><line style="stroke: #000000; stroke-width: 1.0;" x1="249" x2="290" y1="894.3906" y2="894.3906"/><polygon fill="#000000" points="259,890.3906,249,894.3906,259,898.3906,255,894.3906" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="291" x="265" y="866.7539">前のダイアログID(A)に関連する作業の処理を中止する</text><line style="stroke: #000000; stroke-width: 1.0;" x1="248" x2="290" y1="943.4844" y2="943.4844"/><line style="stroke: #000000; stroke-width: 1.0;" x1="290" x2="290" y1="943.4844" y2="956.4844"/><line style="stroke: #000000; stroke-width: 1.0;" x1="249" x2="290" y1="956.4844" y2="956.4844"/><polygon fill="#000000" points="259,952.4844,249,956.4844,259,960.4844,255,956.4844" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="351" x="265" y="928.8477">ダイアログID(A)に関連するディレクティブをキューから破棄する</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="63" x2="677" y1="965.4844" y2="965.4844"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="320" x="78" y="987.9414">[例外が発生してイベントの送信をキャンセルする場合]</text><line style="stroke: #000000; stroke-width: 1.0;" x1="248" x2="290" y1="1042.6719" y2="1042.6719"/><line style="stroke: #000000; stroke-width: 1.0;" x1="290" x2="290" y1="1042.6719" y2="1055.6719"/><line style="stroke: #000000; stroke-width: 1.0;" x1="249" x2="290" y1="1055.6719" y2="1055.6719"/><polygon fill="#000000" points="259,1051.6719,249,1055.6719,259,1059.6719,255,1055.6719" style="stroke: #000000; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans CJK KR" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="303" x="265" y="1028.0352">前のダイアログID(A)に関連する作業を引き続き処理する</text><path d="M74,1013.8203 L74,1050.8203 A5,5 0 0 0 79,1055.8203 L228,1055.8203 A5,5 0 0 0 233,1050.8203 L233,1018.8203 L223,1008.8203 L79,1008.8203 A5,5 0 0 0 74,1013.8203 " fill="#9EA0CA" style="stroke: #FFFFFF; stroke-width: 1.0;"/><path d="M223,1008.8203 L223,1016.3203 A2.5,2.5 0 0 0 225.5,1018.8203 L233,1018.8203 L223,1008.8203 " fill="#9EA0CA" style="stroke: #FFFFFF; stroke-width: 1.0;"/><text fill="#FFFFFF" font-family="Noto Sans CJK KR" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="90" y="1038.3535">lastDialogueID: A</text><!--
@startuml
scale max 880 width
skinparam sequenceMessageAlign center
skinparam shadowing false
skinparam roundcorner 10
skinparam padding 10
skinparam defaultFontSize 12
skinparam defaultFontName "Noto Sans CJK KR"

skinparam note {
  BackgroundColor #9EA0CA
  BorderColor #ffffff
  FontColor #ffffff
  FontSize 14
  FontStyle bold
}

skinparam sequence {
  ArrowColor #000000
  ActorBorderColor #000000
  ActorFontStyle Bolder


  LifeLineBorderColor #000000
  LifeLineBackgroundColor transparent
  ParticipantBorderColor transparent
  ParticipantFontSize 14
  ParticipantFontColor #ffffff
  ParticipantFontStyle bold

  BoxBorderColor #000000
  BoxFontColor #ffffff
    BoxFontSize 14
    BoxFontStyle bold
}
hide footbox

skinparam activity {
  BackgroundColor #9EA0CA
  BarColor #ffffff
  BorderColor #ffffff
  DiamondBackgroundColor #05D686
  DiamondBorderColor #ffffff
  DiamondFontColor #ffffff
  DiamondFontSize 14
  DiamondFontStyle bold
  FontColor #ffffff 
  FontSize 14
  FontStyle bold
}

participant ユーザー as user #9EA0CA
participant クライアント as client #9EA0CA
participant CIC as cic #05D686

user ->> client: クラシック音楽を再生して

activate client

  client -> client: ダイアログID(A)を作成する

  alt 音声でリクエストした場合

    client ->> cic: SpeechRecognizer.Recognizeイベントを送信する\n(header.dialogRequestId: A)

  else テキストでリクエストした場合

    client ->> cic: TextRecognizer.Recognizeイベントを送信する\n(header.dialogRequestId: A)

  end

  client -> client: 最終ダイアログIDを更新する
  
  note left: lastDialogueID: A

  ... リクエストを処理中 ...

user - ->> client: 今の天気を教えて

  client -> client: ダイアログID(B)を作成する

  alt 作業を正常に処理する場合

    client ->> cic: SpeechRecognizer.Recognizeイベントを送信する\n(header.dialogRequestId: B)

    client -> client: 最終ダイアログIDを更新する
  
    note left: lastDialogueID: B

    client -> client: 前のダイアログID(A)に関連する作業の処理を中止する

    client -> client: ダイアログID(A)に関連するディレクティブをキューから破棄する

  else 例外が発生してイベントの送信をキャンセルする場合

    client -> client: 前のダイアログID(A)に関連する作業を引き続き処理する

    note left: lastDialogueID: A

  end

@enduml

PlantUML version 1.2019.09(Tue Aug 27 01:19:51 JST 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_202-b08
Operating System: Windows 10
OS Version: 10.0
Default Encoding: MS932
Language: ja
Country: JP
--></g></svg>