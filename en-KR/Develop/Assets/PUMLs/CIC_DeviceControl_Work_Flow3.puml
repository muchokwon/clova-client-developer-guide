!include ../../../styles/PlantUML_StyleSheet.puml

participant "Bluetooth device" as device #9EA0CA
participant Client as client #9EA0CA
participant "Clova" as clova #05D686
actor User as user #9EA0
activate device
device -> client: Advertising
...
user ->> clova : Requests a Bluetooth device connection
activate clova
  clova -> client : Sends DeviceControl.BtStartPairing directive

activate client
  client -> client : Scans
  client --> clova : Sends DeviceControl.ActionExecuted event\n(with DeviceState)
  hnote over client, device : Found a Bluetooth device
deactivate client

 alt Specific device assigned == Yes
	clova -> client : Sends DeviceControl.BtConnect directive\n(with payload)

	activate client
 else Specific device assigned == No
    clova -> client : Sends DeviceControl.BtConnect directive\n(without payload)
end

  client -> device : Requests connection
  client --> clova : Sends DeviceControl.ActionExecuted event\n(with DeviceState)

	deactivate client
  alt PIN code required == Yes
	device ->> client : Requests PIN code

	activate client
	client -> clova : Sends DeviceControl.BtRequestForPINCode event
    hnote over clova, user #05D686 : Requests PIN code and handle input

    alt Decide to cancel code input == Yes
		client -> clova : Sends DeviceControl.BtRequestToCancelPINCode event
		hnote over clova, user #05D686 : Handles cancellation of PIN code request
    else
 		clova -> client : Sends DeviceControl.BtConnectByPINCode directive
	end
  end
    client -> device : Connects using PIN code
    client -> clova : Sends DeviceControl.ActionExecuted event

	deactivate client
	device -->> client : Returns connection result
 deactivate device

  clova -> user : Notifies of connection result

deactivate clova
